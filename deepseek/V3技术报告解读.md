# V3 技术报告解读

R1脱胎于V3，V3作为一个MoE模型有大量的创新技术，我们逐步的进行解读

## V3的总体介绍

### 总结
![V3技术总结](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/Deepseek%20v3%E6%8A%80%E6%9C%AF%E6%8A%A5%E5%91%8A%E6%A0%B8%E5%BF%83%E8%A7%A3%E8%AF%BB%E4%B8%80.png)

### 高效的训练技术
![高效的训练技术](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/%E9%AB%98%E6%95%88%E8%AE%AD%E7%BB%83%E6%80%BB%E4%BD%93%E6%8A%80%E6%9C%AF%E8%B4%A1%E7%8C%AE.png)

### 训练流程
![训练流程](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/%E8%AE%AD%E7%BB%83%E6%B5%81%E7%A8%8B.png)

### 推理性能支撑
![推理性能支撑](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/%E9%AB%98%E6%95%88%E6%8E%A8%E7%90%86%E5%BA%95%E5%B1%82%E6%8A%80%E6%9C%AF%E6%94%AF%E6%92%91%E6%A0%B8%E5%BF%83%E8%A6%81%E7%B4%A0.png)


## V3训练效率和performance提升的关键

**我们知道MoE架构的router的负载是一个非常核心的技术，负载不均衡会导致训练的失败，那么通常的方法是引入辅助函数，但是辅助函数往往又会影响效率，这是一个进退两难的问题。Deepseek成功的使用了无辅助训练的方式，即保持了负载的平衡又解决了性能的问题。**

### 有辅助GShard技术
**GShard是谷歌发布的一个MoE训练技术，通过双层辅助控制有效解决了负载问题。介绍V3的无辅助之前，我们先看下有辅助的技术**

**GShard总体介绍**

![GShard总体介绍](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/gshard%E6%80%BB%E4%BD%93%E4%BB%8B%E7%BB%8D.png)



**GShard技术细节**


![GShard技术细节](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/Gshard%E7%BB%86%E8%8A%82.png)



**Gshard优势**


![Gshard优势](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/Gshard%E7%9B%B8%E5%AF%B9%E4%BA%8Etopk%E7%9A%84%E5%AF%B9%E6%AF%94.png)




### V3的无辅助训练技术


**相较于Gshard， V3在使用超参做负载均衡控制，token序列中引入辅助控制，非常”轻“的辅助做了负载均衡控制，很牛掰。看公式可能觉得不复杂，但是能在600B+14T的规模下稳定做出来，真的牛。尤其是里面关乎node和expert的控制策略，对计算通信overlap的充分挖觉，不得不说算法和算法工程的配合相当牛逼！**


**总体设计方案**

![总体设计方案](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/deepseek_MoE_base_designe.png)


**路由调整策略**:——引入bias偏置，每个step进行调整，不参与训练过程汇总的后向梯度调整


![无辅助的负载方案](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/Deepseek%E6%97%A0%E8%BE%85%E5%8A%A9%E5%B9%B3%E8%A1%A1%E7%AD%96%E7%95%A5.png)



**序列辅助平衡**——引入序列内的辅助平衡


![技术细节](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/%E5%BA%8F%E5%88%97%E5%B9%B3%E8%A1%A1%E8%BE%85%E5%8A%A9%E7%AD%96%E7%95%A5.png)



**优异的分配策略使得训练过程中无token丢弃**

![无token丢弃](https://github.com/xiangyuliu/material_arrangement/blob/local_edit_20250206/sources/image/Deepseek%E6%97%A0token%E4%B8%A2%E5%BC%83.png)








